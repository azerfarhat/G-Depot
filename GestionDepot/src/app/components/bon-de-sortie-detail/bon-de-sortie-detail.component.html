<div class="bds-detail-container">
  <!-- Bouton de retour √† la liste -->
  <button class="back-button" routerLink="/bons-de-sortie">Retour √† la liste des Bons de Sortie</button>



  <!-- Section principale des d√©tails, affich√©e seulement si l'objet bonDeSortie est d√©fini -->
  @if (bonDeSortie) {
    <h2>D√©tails du Bon de Sortie #{{ bonDeSortie.id }} ({{ bonDeSortie.numeroBDS }})</h2>
    <div class="bds-info">
      <p><strong>Chauffeur:</strong> {{ bonDeSortie.chauffeur?.nom || 'N/A' }}</p>
      <p><strong>Date de Sortie:</strong> {{ bonDeSortie.dateSortie | date:'medium' }}</p>
      <p><strong>Statut:</strong> {{ bonDeSortie.statut }}</p>
      <p><strong>Commande d'Origine:</strong>
        <!-- Affichage conditionnel du lien vers la commande si un ID de commande est pr√©sent -->
        @if (bonDeSortie.commandeOrigineId) {
          <a [routerLink]="['/commandes', bonDeSortie.commandeOrigineId]">{{ bonDeSortie.commandeOrigineId }}</a>
        } @else {
          N/A
        }
      </p>
      <p><strong>Valeur Totale Initiale:</strong> {{ bonDeSortie.valeurTotaleInitialeTTC | currency:'EUR':'symbol':'1.2-2' }}</p>
    </div>

    <!-- Section des produits du Bon de Sortie -->
    <h3>Produits du Bon de Sortie</h3>
    @if (bonDeSortie.lignes && bonDeSortie.lignes.length > 0) {
      <table class="lignes-bds-table">
        <thead>
          <tr>
            <th>Produit</th>
            <th>Qt√© Sortie</th>
            <th>Qt√© Retourn√©e</th>
            <th>Qt√© Factur√©e</th>
            <th>Qt√© Dispo pour Facturation</th>
            <th>Prix Unitaire TTC</th>
          </tr>
        </thead>
        <tbody>
          <!-- It√©ration sur les lignes du bon de sortie -->
          @for (ligne of bonDeSortie.lignes; track ligne.id) {
            <tr>
              <td>{{ ligne.nomProduit }} (ID: {{ ligne.produitId }})</td>
              <td>{{ ligne.quantiteSortie }}</td>
              <td>{{ ligne.quantiteRetournee }}</td>
              <td>{{ ligne.quantiteFacturee }}</td>
              <td><strong>{{ ligne.quantiteDisponiblePourFacturation }}</strong></td>
              <td>{{ ligne.prixUnitaireTTC | currency:'EUR':'symbol':'1.2-2' }}</td>
            </tr>
          }
        </tbody>
      </table>
    } @else {
      <p>Ce Bon de Sortie ne contient aucune ligne de produit.</p>
    }

    <!-- Section des factures li√©es au Bon de Sortie -->
    <h3>Factures Li√©es</h3>
    @if (bonDeSortie.factures && bonDeSortie.factures.length > 0) {
      <div class="table-wrapper">
        <table class="factures-liees-table">
          <thead>
            <tr>
              <th>N¬∞ Facture</th>
              <th>Date Facturation</th>
              <th>Total TTC</th>
              <th>Statut</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <!-- It√©ration sur les factures li√©es -->
            @for (facture of bonDeSortie.factures; track facture.id) {
              <tr>
                <td>{{ facture.numeroFacture }}</td>
                <td>{{ facture.dateFacturation | date:'mediumDate' }}</td>
                <td>{{ facture.totalTTC | currency:'EUR':'symbol':'1.2-2' }}</td>
                <td>{{ facture.statut }}</td>
                <td>
                  <!-- Bouton pour voir les d√©tails d'une facture sp√©cifique -->
                  <a [routerLink]="['/factures', facture.id]" class="icon-button" title="Voir Facture">üëÅÔ∏è</a>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    } @else {
      <p>Aucune facture li√©e √† ce Bon de Sortie pour l'instant.</p>
    }

  } @else {
    <p>Chargement des d√©tails du Bon de Sortie...</p>
  }
</div>